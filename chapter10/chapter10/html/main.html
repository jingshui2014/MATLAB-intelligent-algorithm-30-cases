
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>main</title><meta name="generator" content="MATLAB 8.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-06-05"><meta name="DC.source" content="main.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">&#35813;&#20989;&#25968;&#28436;&#31034;&#22810;&#30446;&#26631;perota&#20248;&#21270;&#38382;&#39064;</a></li><li><a href="#2">&#21021;&#22987;&#21442;&#25968;</a></li><li><a href="#3">&#21021;&#22987;&#31579;&#36873;&#38750;&#21155;&#35299;</a></li><li><a href="#4">&#24490;&#29615;&#36845;&#20195;</a></li><li><a href="#6">&#32676;&#20307;&#26356;&#26032;</a></li><li><a href="#7">&#35745;&#31639;&#20010;&#20307;&#36866;&#24212;&#24230;</a></li><li><a href="#8">&#26356;&#26032;&#31890;&#23376;&#21382;&#21490;&#26368;&#20339;</a></li><li><a href="#9">&#26356;&#26032;&#38750;&#21155;&#35299;&#38598;&#21512;</a></li></ul></div><h2>&#35813;&#20989;&#25968;&#28436;&#31034;&#22810;&#30446;&#26631;perota&#20248;&#21270;&#38382;&#39064;<a name="1"></a></h2><pre class="codeinput"><span class="comment">%&#28165;&#31354;&#29615;&#22659;</span>
clc
clear

load <span class="string">data</span>
</pre><h2>&#21021;&#22987;&#21442;&#25968;<a name="2"></a></h2><pre class="codeinput">objnum=size(P,1); <span class="comment">%&#31867;&#20013;&#29289;&#21697;&#20010;&#25968;</span>
weight=92;        <span class="comment">%&#24635;&#37325;&#37327;&#38480;&#21046;</span>

<span class="comment">%&#21021;&#22987;&#21270;&#31243;&#24207;</span>
Dim=5;     <span class="comment">%&#31890;&#23376;&#32500;&#25968;</span>
xSize=50;  <span class="comment">%&#31181;&#32676;&#20010;&#25968;</span>
MaxIt=200; <span class="comment">%&#36845;&#20195;&#27425;&#25968;</span>
c1=0.8;    <span class="comment">%&#31639;&#27861;&#21442;&#25968;</span>
c2=0.8;    <span class="comment">%&#31639;&#27861;&#21442;&#25968;</span>
wmax=1.2;  <span class="comment">%&#24815;&#24615;&#22240;&#23376;</span>
wmin=0.1;  <span class="comment">%&#24815;&#24615;&#22240;&#23376;</span>

x=unidrnd(4,xSize,Dim);  <span class="comment">%&#31890;&#23376;&#21021;&#22987;&#21270;</span>
v=zeros(xSize,Dim);      <span class="comment">%&#36895;&#24230;&#21021;&#22987;&#21270;</span>

xbest=x;           <span class="comment">%&#20010;&#20307;&#26368;&#20339;&#20540;</span>
gbest=x(1,:);      <span class="comment">%&#31890;&#23376;&#32676;&#26368;&#20339;&#20301;&#32622;</span>

<span class="comment">% &#31890;&#23376;&#36866;&#24212;&#24230;&#20540;</span>
px=zeros(1,xSize);   <span class="comment">%&#31890;&#23376;&#20215;&#20540;&#30446;&#26631;</span>
rx=zeros(1,xSize);   <span class="comment">%&#31890;&#23376;&#20307;&#31215;&#30446;&#26631;</span>
cx=zeros(1,xSize);   <span class="comment">%&#37325;&#37327;&#32422;&#26463;</span>

<span class="comment">% &#26368;&#20248;&#20540;&#21021;&#22987;&#21270;</span>
pxbest=zeros(1,xSize); <span class="comment">%&#31890;&#23376;&#26368;&#20248;&#20215;&#20540;&#30446;&#26631;</span>
rxbest=zeros(1,xSize); <span class="comment">%&#31890;&#23376;&#26368;&#20248;&#20307;&#31215;&#30446;&#26631;</span>
cxbest=zeros(1,xSize);  <span class="comment">%&#35760;&#24405;&#37325;&#37327;&#65292;&#20197;&#27714;&#32422;&#26463;</span>

<span class="comment">% &#19978;&#19968;&#27425;&#30340;&#20540;</span>
pxPrior=zeros(1,xSize);<span class="comment">%&#31890;&#23376;&#20215;&#20540;&#30446;&#26631;</span>
rxPrior=zeros(1,xSize);<span class="comment">%&#31890;&#23376;&#20307;&#31215;&#30446;&#26631;</span>
cxPrior=zeros(1,xSize);<span class="comment">%&#35760;&#24405;&#37325;&#37327;&#65292;&#20197;&#27714;&#32422;&#26463;</span>

<span class="comment">%&#35745;&#31639;&#21021;&#22987;&#30446;&#26631;&#21521;&#37327;</span>
<span class="keyword">for</span> i=1:xSize
    <span class="keyword">for</span> j=1:Dim <span class="comment">%&#25511;&#21046;&#31867;&#21035;</span>
        px(i) = px(i)+P(x(i,j),j);  <span class="comment">%&#31890;&#23376;&#20215;&#20540;</span>
        rx(i) = rx(i)+R(x(i,j),j);  <span class="comment">%&#31890;&#23376;&#20307;&#31215;</span>
        cx(i) = cx(i)+C(x(i,j),j);  <span class="comment">%&#31890;&#23376;&#37325;&#37327;</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="comment">% &#31890;&#23376;&#26368;&#20248;&#20301;&#32622;</span>
pxbest=px;rxbest=rx;cxbest=cx;
</pre><h2>&#21021;&#22987;&#31579;&#36873;&#38750;&#21155;&#35299;<a name="3"></a></h2><pre class="codeinput">flj=[];
fljx=[];
fljNum=0;
<span class="comment">%&#20004;&#20010;&#23454;&#25968;&#30456;&#31561;&#31934;&#24230;</span>
tol=1e-7;
<span class="keyword">for</span> i=1:xSize
    flag=0;  <span class="comment">%&#25903;&#37197;&#26631;&#24535;</span>
    <span class="keyword">for</span> j=1:xSize
        <span class="keyword">if</span> j~=i
            <span class="keyword">if</span> ((px(i)&lt;px(j)) &amp;&amp;  (rx(i)&gt;rx(j))) ||((abs(px(i)-px(j))&lt;tol)<span class="keyword">...</span>
                    &amp;&amp;  (rx(i)&gt;rx(j)))||((px(i)&lt;px(j)) &amp;&amp;  (abs(rx(i)-rx(j))&lt;tol)) || (cx(i)&gt;weight)
                flag=1;
                <span class="keyword">break</span>;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">%&#21028;&#26029;&#26377;&#26080;&#34987;&#25903;&#37197;</span>
    <span class="keyword">if</span> flag==0
        fljNum=fljNum+1;
        <span class="comment">% &#35760;&#24405;&#38750;&#21155;&#35299;</span>
        flj(fljNum,1)=px(i);flj(fljNum,2)=rx(i);flj(fljNum,3)=cx(i);
        <span class="comment">% &#38750;&#21155;&#35299;&#20301;&#32622;</span>
        fljx(fljNum,:)=x(i,:);
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2>&#24490;&#29615;&#36845;&#20195;<a name="4"></a></h2><pre class="codeinput"><span class="keyword">for</span> iter=1:MaxIt
</pre><pre class="codeinput">    <span class="comment">% &#26435;&#20540;&#26356;&#26032;</span>
    w=wmax-(wmax-wmin)*iter/MaxIt;

    <span class="comment">%&#20174;&#38750;&#21155;&#35299;&#20013;&#36873;&#25321;&#31890;&#23376;&#20316;&#20026;&#20840;&#23616;&#26368;&#20248;&#35299;</span>
    s=size(fljx,1);
    index=randi(s,1,1);
    gbest=fljx(index,:);
</pre><h2>&#32676;&#20307;&#26356;&#26032;<a name="6"></a></h2><pre class="codeinput">    <span class="keyword">for</span> i=1:xSize
        <span class="comment">%&#36895;&#24230;&#26356;&#26032;</span>
        v(i,:)=w*v(i,:)+c1*rand(1,1)*(xbest(i,:)-x(i,:))+c2*rand(1,1)*(gbest-x(i,:));

        <span class="comment">%&#20301;&#32622;&#26356;&#26032;</span>
        x(i,:)=x(i,:)+v(i,:);
        x(i,:) = rem(x(i,:),objnum)/double(objnum);
        index1=find(x(i,:)&lt;=0);
        <span class="keyword">if</span> ~isempty(index1)
            x(i,index1)=rand(size(index1));
        <span class="keyword">end</span>
        x(i,:)=ceil(4*x(i,:));
    <span class="keyword">end</span>
</pre><h2>&#35745;&#31639;&#20010;&#20307;&#36866;&#24212;&#24230;<a name="7"></a></h2><pre class="codeinput">    pxPrior(:)=0;
    rxPrior(:)=0;
    cxPrior(:)=0;
    <span class="keyword">for</span> i=1:xSize
        <span class="keyword">for</span> j=1:Dim <span class="comment">%&#25511;&#21046;&#31867;&#21035;</span>
            pxPrior(i) = pxPrior(i)+P(x(i,j),j);  <span class="comment">%&#35745;&#31639;&#31890;&#23376;i &#20215;&#20540;</span>
            rxPrior(i) = rxPrior(i)+R(x(i,j),j);  <span class="comment">%&#35745;&#31639;&#31890;&#23376;i &#20307;&#31215;</span>
            cxPrior(i) = cxPrior(i)+C(x(i,j),j);  <span class="comment">%&#35745;&#31639;&#31890;&#23376;i &#37325;&#37327;</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
</pre><h2>&#26356;&#26032;&#31890;&#23376;&#21382;&#21490;&#26368;&#20339;<a name="8"></a></h2><pre class="codeinput">    <span class="keyword">for</span> i=1:xSize
        <span class="comment">%&#29616;&#22312;&#30340;&#25903;&#37197;&#21407;&#26377;&#30340;&#65292;&#26367;&#20195;&#21407;&#26377;&#30340;</span>
         <span class="keyword">if</span> ((px(i)&lt;pxPrior(i)) &amp;&amp;  (rx(i)&gt;rxPrior(i))) ||((abs(px(i)-pxPrior(i))&lt;tol)<span class="keyword">...</span>
                 &amp;&amp;  (rx(i)&gt;rxPrior(i)))||((px(i)&lt;pxPrior(i)) &amp;&amp;  (abs(rx(i)-rxPrior(i))&lt;tol)) || (cx(i)&gt;weight)
                xbest(i,:)=x(i,:);<span class="comment">%&#27809;&#26377;&#35760;&#24405;&#30446;&#26631;&#20540;</span>
                pxbest(i)=pxPrior(i);rxbest(i)=rxPrior(i);cxbest(i)=cxPrior(i);
          <span class="keyword">end</span>

        <span class="comment">%&#24444;&#27492;&#19981;&#21463;&#25903;&#37197;&#65292;&#38543;&#26426;&#20915;&#23450;</span>
        <span class="keyword">if</span> ~( ((px(i)&lt;pxPrior(i)) &amp;&amp;  (rx(i)&gt;rxPrior(i))) ||((abs(px(i)-pxPrior(i))&lt;tol)<span class="keyword">...</span>
                &amp;&amp;  (rx(i)&gt;rxPrior(i)))||((px(i)&lt;pxPrior(i)) &amp;&amp;  (abs(rx(i)-rxPrior(i))&lt;tol)) || (cx(i)&gt;weight) )<span class="keyword">...</span>
                &amp;&amp;  ~( ((pxPrior(i)&lt;px(i)) &amp;&amp;  (rxPrior(i)&gt;rx(i))) ||((abs(pxPrior(i)-px(i))&lt;tol) &amp;&amp;  (rxPrior(i)&gt;rx(i)))<span class="keyword">...</span>
                ||((pxPrior(i)&lt;px(i)) &amp;&amp;  (abs(rxPrior(i)-rx(i))&lt;tol)) || (cxPrior(i)&gt;weight) )
            <span class="keyword">if</span> rand(1,1)&lt;0.5
                xbest(i,:)=x(i,:);
                  pxbest(i)=pxPrior(i);rxbest(i)=rxPrior(i);cxbest(i)=cxPrior(i);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
</pre><h2>&#26356;&#26032;&#38750;&#21155;&#35299;&#38598;&#21512;<a name="9"></a></h2><pre class="codeinput">    px=pxPrior;
    rx=rxPrior;
    cx=cxPrior;
    <span class="comment">%&#26356;&#26032;&#21319;&#32423;&#38750;&#21155;&#35299;&#38598;&#21512;</span>
    s=size(flj,1);<span class="comment">%&#30446;&#21069;&#38750;&#21155;&#35299;&#38598;&#21512;&#20013;&#20803;&#32032;&#20010;&#25968;</span>

    <span class="comment">%&#20808;&#23558;&#38750;&#21155;&#35299;&#38598;&#21512;&#21644;xbest&#21512;&#24182;</span>
    pppx=zeros(1,s+xSize);
    rrrx=zeros(1,s+xSize);
    cccx=zeros(1,s+xSize);
    pppx(1:xSize)=pxbest;pppx(xSize+1:end)=flj(:,1)';
    rrrx(1:xSize)=rxbest;rrrx(xSize+1:end)=flj(:,2)';
    cccx(1:xSize)=cxbest;cccx(xSize+1:end)=flj(:,3)';
    xxbest=zeros(s+xSize,Dim);
    xxbest(1:xSize,:)=xbest;
    xxbest(xSize+1:end,:)=fljx;

    <span class="comment">%&#31579;&#36873;&#38750;&#21155;&#35299;</span>
    flj=[];
    fljx=[];
    k=0;
    tol=1e-7;
    <span class="keyword">for</span> i=1:xSize+s
        flag=0;<span class="comment">%&#27809;&#26377;&#34987;&#25903;&#37197;</span>
        <span class="comment">%&#21028;&#26029;&#35813;&#28857;&#26159;&#21542;&#38750;&#21155;</span>
        <span class="keyword">for</span> j=1:xSize+s
            <span class="keyword">if</span> j~=i
                <span class="keyword">if</span> ((pppx(i)&lt;pppx(j)) &amp;&amp;  (rrrx(i)&gt;rrrx(j))) ||((abs(pppx(i)-pppx(j))&lt;tol) <span class="keyword">...</span>
                        &amp;&amp;  (rrrx(i)&gt;rrrx(j)))||((pppx(i)&lt;pppx(j)) &amp;&amp;  (abs(rrrx(i)-rrrx(j))&lt;tol)) <span class="keyword">...</span>
                        || (cccx(i)&gt;weight) <span class="comment">%&#26377;&#19968;&#27425;&#34987;&#25903;&#37197;</span>
                    flag=1;
                    <span class="keyword">break</span>;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="comment">%&#21028;&#26029;&#26377;&#26080;&#34987;&#25903;&#37197;</span>
        <span class="keyword">if</span> flag==0
            k=k+1;
            flj(k,1)=pppx(i);flj(k,2)=rrrx(i);flj(k,3)=cccx(i);<span class="comment">%&#35760;&#24405;&#38750;&#21155;&#35299;</span>
            fljx(k,:)=xxbest(i,:);<span class="comment">%&#38750;&#21155;&#35299;&#20301;&#32622;</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">%&#21435;&#25481;&#37325;&#22797;&#31890;&#23376;</span>
    repflag=0;   <span class="comment">%&#37325;&#22797;&#26631;&#24535;</span>
    k=1;         <span class="comment">%&#19981;&#21516;&#38750;&#21155;&#35299;&#31890;&#23376;&#25968;</span>
    flj2=[];     <span class="comment">%&#23384;&#20648;&#19981;&#21516;&#38750;&#21155;&#35299;</span>
    fljx2=[];    <span class="comment">%&#23384;&#20648;&#19981;&#21516;&#38750;&#21155;&#35299;&#31890;&#23376;&#20301;&#32622;</span>
    flj2(k,:)=flj(1,:);
    fljx2(k,:)=fljx(1,:);
    <span class="keyword">for</span> j=2:size(flj,1)
        repflag=0;  <span class="comment">%&#37325;&#22797;&#26631;&#24535;</span>
        <span class="keyword">for</span> i=1:size(flj2,1)
            result=(fljx(j,:)==fljx2(i,:));
            <span class="keyword">if</span> length(find(result==1))==Dim
                repflag=1;<span class="comment">%&#26377;&#37325;&#22797;</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="comment">%&#31890;&#23376;&#19981;&#21516;&#65292;&#23384;&#20648;</span>
        <span class="keyword">if</span> repflag==0
            k=k+1;
            flj2(k,:)=flj(j,:);
            fljx2(k,:)=fljx(j,:);
        <span class="keyword">end</span>

    <span class="keyword">end</span>

    <span class="comment">%&#38750;&#21155;&#35299;&#26356;&#26032;</span>
    flj=flj2;
    fljx=fljx2;
</pre><pre class="codeinput"><span class="keyword">end</span>

<span class="comment">%&#32472;&#21046;&#38750;&#21155;&#35299;&#20998;&#24067;</span>
plot(flj(:,1),flj(:,2),<span class="string">'o'</span>)
xlabel(<span class="string">'P'</span>)
ylabel(<span class="string">'R'</span>)
title(<span class="string">'&#26368;&#32456;&#38750;&#21155;&#35299;&#22312;&#30446;&#26631;&#31354;&#38388;&#20998;&#24067;'</span>)
disp(<span class="string">'&#38750;&#21155;&#35299;flj&#20013;&#19977;&#21015;&#20381;&#27425;&#20026;P&#65292;R&#65292;C'</span>)
</pre><pre class="codeoutput">&#38750;&#21155;&#35299;flj&#20013;&#19977;&#21015;&#20381;&#27425;&#20026;P&#65292;R&#65292;C
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2012b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% 该函数演示多目标perota优化问题
%清空环境
clc
clear

load data


%% 初始参数
objnum=size(P,1); %类中物品个数
weight=92;        %总重量限制

%初始化程序
Dim=5;     %粒子维数
xSize=50;  %种群个数
MaxIt=200; %迭代次数
c1=0.8;    %算法参数
c2=0.8;    %算法参数 
wmax=1.2;  %惯性因子
wmin=0.1;  %惯性因子

x=unidrnd(4,xSize,Dim);  %粒子初始化
v=zeros(xSize,Dim);      %速度初始化

xbest=x;           %个体最佳值
gbest=x(1,:);      %粒子群最佳位置

% 粒子适应度值 
px=zeros(1,xSize);   %粒子价值目标
rx=zeros(1,xSize);   %粒子体积目标
cx=zeros(1,xSize);   %重量约束

% 最优值初始化
pxbest=zeros(1,xSize); %粒子最优价值目标
rxbest=zeros(1,xSize); %粒子最优体积目标
cxbest=zeros(1,xSize);  %记录重量，以求约束

% 上一次的值
pxPrior=zeros(1,xSize);%粒子价值目标
rxPrior=zeros(1,xSize);%粒子体积目标
cxPrior=zeros(1,xSize);%记录重量，以求约束

%计算初始目标向量
for i=1:xSize
    for j=1:Dim %控制类别
        px(i) = px(i)+P(x(i,j),j);  %粒子价值
        rx(i) = rx(i)+R(x(i,j),j);  %粒子体积
        cx(i) = cx(i)+C(x(i,j),j);  %粒子重量
    end
end
% 粒子最优位置
pxbest=px;rxbest=rx;cxbest=cx;

%% 初始筛选非劣解
flj=[];
fljx=[];
fljNum=0;
%两个实数相等精度
tol=1e-7;
for i=1:xSize
    flag=0;  %支配标志
    for j=1:xSize  
        if j~=i
            if ((px(i)<px(j)) &&  (rx(i)>rx(j))) ||((abs(px(i)-px(j))<tol)...
                    &&  (rx(i)>rx(j)))||((px(i)<px(j)) &&  (abs(rx(i)-rx(j))<tol)) || (cx(i)>weight) 
                flag=1;
                break;
            end
        end
    end
    
    %判断有无被支配
    if flag==0
        fljNum=fljNum+1;
        % 记录非劣解
        flj(fljNum,1)=px(i);flj(fljNum,2)=rx(i);flj(fljNum,3)=cx(i);
        % 非劣解位置
        fljx(fljNum,:)=x(i,:); 
    end
end

%% 循环迭代
for iter=1:MaxIt
    
    % 权值更新
    w=wmax-(wmax-wmin)*iter/MaxIt;
     
    %从非劣解中选择粒子作为全局最优解
    s=size(fljx,1);       
    index=randi(s,1,1);  
    gbest=fljx(index,:);

    %% 群体更新
    for i=1:xSize
        %速度更新
        v(i,:)=w*v(i,:)+c1*rand(1,1)*(xbest(i,:)-x(i,:))+c2*rand(1,1)*(gbest-x(i,:));
        
        %位置更新
        x(i,:)=x(i,:)+v(i,:);
        x(i,:) = rem(x(i,:),objnum)/double(objnum);
        index1=find(x(i,:)<=0);
        if ~isempty(index1)
            x(i,index1)=rand(size(index1));
        end
        x(i,:)=ceil(4*x(i,:));        
    end
    
    %% 计算个体适应度
    pxPrior(:)=0;
    rxPrior(:)=0;
    cxPrior(:)=0;
    for i=1:xSize
        for j=1:Dim %控制类别
            pxPrior(i) = pxPrior(i)+P(x(i,j),j);  %计算粒子i 价值
            rxPrior(i) = rxPrior(i)+R(x(i,j),j);  %计算粒子i 体积
            cxPrior(i) = cxPrior(i)+C(x(i,j),j);  %计算粒子i 重量
        end
    end
    
    %% 更新粒子历史最佳
    for i=1:xSize
        %现在的支配原有的，替代原有的
         if ((px(i)<pxPrior(i)) &&  (rx(i)>rxPrior(i))) ||((abs(px(i)-pxPrior(i))<tol)...
                 &&  (rx(i)>rxPrior(i)))||((px(i)<pxPrior(i)) &&  (abs(rx(i)-rxPrior(i))<tol)) || (cx(i)>weight) 
                xbest(i,:)=x(i,:);%没有记录目标值
                pxbest(i)=pxPrior(i);rxbest(i)=rxPrior(i);cxbest(i)=cxPrior(i);
          end
        
        %彼此不受支配，随机决定
        if ~( ((px(i)<pxPrior(i)) &&  (rx(i)>rxPrior(i))) ||((abs(px(i)-pxPrior(i))<tol)...
                &&  (rx(i)>rxPrior(i)))||((px(i)<pxPrior(i)) &&  (abs(rx(i)-rxPrior(i))<tol)) || (cx(i)>weight) )...
                &&  ~( ((pxPrior(i)<px(i)) &&  (rxPrior(i)>rx(i))) ||((abs(pxPrior(i)-px(i))<tol) &&  (rxPrior(i)>rx(i)))...
                ||((pxPrior(i)<px(i)) &&  (abs(rxPrior(i)-rx(i))<tol)) || (cxPrior(i)>weight) )
            if rand(1,1)<0.5
                xbest(i,:)=x(i,:);
                  pxbest(i)=pxPrior(i);rxbest(i)=rxPrior(i);cxbest(i)=cxPrior(i);
            end
        end
    end

    %% 更新非劣解集合
    px=pxPrior;
    rx=rxPrior;
    cx=cxPrior;
    %更新升级非劣解集合
    s=size(flj,1);%目前非劣解集合中元素个数
   
    %先将非劣解集合和xbest合并
    pppx=zeros(1,s+xSize);
    rrrx=zeros(1,s+xSize);
    cccx=zeros(1,s+xSize);
    pppx(1:xSize)=pxbest;pppx(xSize+1:end)=flj(:,1)';
    rrrx(1:xSize)=rxbest;rrrx(xSize+1:end)=flj(:,2)';
    cccx(1:xSize)=cxbest;cccx(xSize+1:end)=flj(:,3)';
    xxbest=zeros(s+xSize,Dim);
    xxbest(1:xSize,:)=xbest;
    xxbest(xSize+1:end,:)=fljx;
   
    %筛选非劣解
    flj=[];
    fljx=[];
    k=0;
    tol=1e-7;
    for i=1:xSize+s
        flag=0;%没有被支配
        %判断该点是否非劣
        for j=1:xSize+s 
            if j~=i
                if ((pppx(i)<pppx(j)) &&  (rrrx(i)>rrrx(j))) ||((abs(pppx(i)-pppx(j))<tol) ...
                        &&  (rrrx(i)>rrrx(j)))||((pppx(i)<pppx(j)) &&  (abs(rrrx(i)-rrrx(j))<tol)) ...
                        || (cccx(i)>weight) %有一次被支配
                    flag=1;
                    break;
                end
            end
        end

        %判断有无被支配
        if flag==0
            k=k+1;
            flj(k,1)=pppx(i);flj(k,2)=rrrx(i);flj(k,3)=cccx(i);%记录非劣解
            fljx(k,:)=xxbest(i,:);%非劣解位置
        end
    end
    
    %去掉重复粒子
    repflag=0;   %重复标志
    k=1;         %不同非劣解粒子数
    flj2=[];     %存储不同非劣解
    fljx2=[];    %存储不同非劣解粒子位置
    flj2(k,:)=flj(1,:);
    fljx2(k,:)=fljx(1,:);
    for j=2:size(flj,1)
        repflag=0;  %重复标志
        for i=1:size(flj2,1)
            result=(fljx(j,:)==fljx2(i,:));
            if length(find(result==1))==Dim
                repflag=1;%有重复
            end
        end
        %粒子不同，存储
        if repflag==0 
            k=k+1;
            flj2(k,:)=flj(j,:);
            fljx2(k,:)=fljx(j,:);
        end
        
    end
    
    %非劣解更新
    flj=flj2;
    fljx=fljx2;

end

%绘制非劣解分布
plot(flj(:,1),flj(:,2),'o') 
xlabel('P')
ylabel('R')
title('最终非劣解在目标空间分布')
disp('非劣解flj中三列依次为P，R，C')
##### SOURCE END #####
--></body></html>